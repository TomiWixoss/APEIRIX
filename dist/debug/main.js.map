{"version":3,"sources":["../../scripts/main.ts"],"sourcesContent":["import { world, EquipmentSlot, GameMode, system } from \"@minecraft/server\";\r\n\r\n// Danh sách custom tools cần mất độ bền khi đào\r\nconst CUSTOM_TOOLS = [\"custom:tool\", \"custom:weapon\"];\r\n\r\n// Hàm damage item với hỗ trợ Unbreaking\r\nfunction damageItem(item: any) {\r\n  if (!item) return null;\r\n\r\n  const durabilityComponent = item.getComponent(\"durability\");\r\n  if (!durabilityComponent) return item;\r\n\r\n  let unbreakingLevel = 0;\r\n\r\n  // Kiểm tra enchantment Unbreaking\r\n  if (item.hasComponent(\"enchantments\")) {\r\n    const enchantments = item.getComponent(\"enchantments\").enchantments;\r\n    const unbreaking = enchantments.getEnchantment(\"unbreaking\");\r\n    if (unbreaking) {\r\n      unbreakingLevel = unbreaking.level;\r\n    }\r\n  }\r\n\r\n  // Tính toán damage chance với Unbreaking\r\n  const damageChance = durabilityComponent.getDamageChance(unbreakingLevel);\r\n  const shouldDamage = Math.random() * 100 <= damageChance;\r\n\r\n  if (shouldDamage) {\r\n    // Kiểm tra nếu đã max durability thì phá vỡ item\r\n    if (durabilityComponent.damage >= durabilityComponent.maxDurability - 1) {\r\n      return null; // Item bị phá vỡ\r\n    }\r\n    durabilityComponent.damage += 1;\r\n  }\r\n\r\n  return item;\r\n}\r\n\r\n// Event khi player đào block\r\nworld.afterEvents.playerBreakBlock.subscribe((event) => {\r\n  const player = event.player;\r\n\r\n  // Bỏ qua nếu player ở creative mode\r\n  if (player.getGameMode() === GameMode.Creative) return;\r\n\r\n  // Lấy item đang cầm\r\n  const equipment = player.getComponent(\"equippable\");\r\n  if (!equipment) return;\r\n\r\n  const mainhandItem = equipment.getEquipment(EquipmentSlot.Mainhand);\r\n  if (!mainhandItem) return;\r\n\r\n  // Kiểm tra nếu là custom tool\r\n  if (!CUSTOM_TOOLS.includes(mainhandItem.typeId)) return;\r\n\r\n  // Damage item\r\n  const newItem = damageItem(mainhandItem);\r\n\r\n  // Set lại item (hoặc null nếu bị phá vỡ)\r\n  equipment.setEquipment(EquipmentSlot.Mainhand, newItem);\r\n\r\n  // Play sound khi item bị phá vỡ\r\n  if (!newItem) {\r\n    player.playSound(\"random.break\");\r\n  }\r\n});\r\n\r\n// Event khi player đánh entity (để weapon cũng mất độ bền)\r\nworld.afterEvents.entityHurt.subscribe((event) => {\r\n  const damageSource = event.damageSource;\r\n  if (!damageSource.damagingEntity) return;\r\n\r\n  const attacker = damageSource.damagingEntity;\r\n\r\n  // Chỉ xử lý nếu attacker là player\r\n  if (attacker.typeId !== \"minecraft:player\") return;\r\n\r\n  const equipment = attacker.getComponent(\"equippable\");\r\n  if (!equipment) return;\r\n\r\n  const weapon = equipment.getEquipment(EquipmentSlot.Mainhand);\r\n  if (!weapon) return;\r\n\r\n  // Kiểm tra nếu là custom weapon\r\n  if (!CUSTOM_TOOLS.includes(weapon.typeId)) return;\r\n\r\n  // Damage weapon\r\n  const newWeapon = damageItem(weapon);\r\n\r\n  // Set lại weapon\r\n  equipment.setEquipment(EquipmentSlot.Mainhand, newWeapon);\r\n\r\n  // Play sound khi weapon bị phá vỡ\r\n  if (!newWeapon && attacker.typeId === \"minecraft:player\") {\r\n    (attacker as any).playSound(\"random.break\");\r\n  }\r\n});\r\n\r\n// Hello message mỗi 100 ticks\r\nfunction mainTick() {\r\n  if (system.currentTick % 100 === 0) {\r\n    world.sendMessage(\"Custom Addon Active! Tick: \" + system.currentTick);\r\n  }\r\n  system.run(mainTick);\r\n}\r\n\r\nsystem.run(mainTick);\r\n"],"mappings":";AAAA,SAAS,OAAO,eAAe,UAAU,cAAc;AAGvD,IAAM,eAAe,CAAC,eAAe,eAAe;AAGpD,SAAS,WAAW,MAAW;AAC7B,MAAI,CAAC,KAAM,QAAO;AAElB,QAAM,sBAAsB,KAAK,aAAa,YAAY;AAC1D,MAAI,CAAC,oBAAqB,QAAO;AAEjC,MAAI,kBAAkB;AAGtB,MAAI,KAAK,aAAa,cAAc,GAAG;AACrC,UAAM,eAAe,KAAK,aAAa,cAAc,EAAE;AACvD,UAAM,aAAa,aAAa,eAAe,YAAY;AAC3D,QAAI,YAAY;AACd,wBAAkB,WAAW;AAAA,IAC/B;AAAA,EACF;AAGA,QAAM,eAAe,oBAAoB,gBAAgB,eAAe;AACxE,QAAM,eAAe,KAAK,OAAO,IAAI,OAAO;AAE5C,MAAI,cAAc;AAEhB,QAAI,oBAAoB,UAAU,oBAAoB,gBAAgB,GAAG;AACvE,aAAO;AAAA,IACT;AACA,wBAAoB,UAAU;AAAA,EAChC;AAEA,SAAO;AACT;AAGA,MAAM,YAAY,iBAAiB,UAAU,CAAC,UAAU;AACtD,QAAM,SAAS,MAAM;AAGrB,MAAI,OAAO,YAAY,MAAM,SAAS,SAAU;AAGhD,QAAM,YAAY,OAAO,aAAa,YAAY;AAClD,MAAI,CAAC,UAAW;AAEhB,QAAM,eAAe,UAAU,aAAa,cAAc,QAAQ;AAClE,MAAI,CAAC,aAAc;AAGnB,MAAI,CAAC,aAAa,SAAS,aAAa,MAAM,EAAG;AAGjD,QAAM,UAAU,WAAW,YAAY;AAGvC,YAAU,aAAa,cAAc,UAAU,OAAO;AAGtD,MAAI,CAAC,SAAS;AACZ,WAAO,UAAU,cAAc;AAAA,EACjC;AACF,CAAC;AAGD,MAAM,YAAY,WAAW,UAAU,CAAC,UAAU;AAChD,QAAM,eAAe,MAAM;AAC3B,MAAI,CAAC,aAAa,eAAgB;AAElC,QAAM,WAAW,aAAa;AAG9B,MAAI,SAAS,WAAW,mBAAoB;AAE5C,QAAM,YAAY,SAAS,aAAa,YAAY;AACpD,MAAI,CAAC,UAAW;AAEhB,QAAM,SAAS,UAAU,aAAa,cAAc,QAAQ;AAC5D,MAAI,CAAC,OAAQ;AAGb,MAAI,CAAC,aAAa,SAAS,OAAO,MAAM,EAAG;AAG3C,QAAM,YAAY,WAAW,MAAM;AAGnC,YAAU,aAAa,cAAc,UAAU,SAAS;AAGxD,MAAI,CAAC,aAAa,SAAS,WAAW,oBAAoB;AACxD,IAAC,SAAiB,UAAU,cAAc;AAAA,EAC5C;AACF,CAAC;AAGD,SAAS,WAAW;AAClB,MAAI,OAAO,cAAc,QAAQ,GAAG;AAClC,UAAM,YAAY,gCAAgC,OAAO,WAAW;AAAA,EACtE;AACA,SAAO,IAAI,QAAQ;AACrB;AAEA,OAAO,IAAI,QAAQ;","names":[],"file":"../scripts/main.js"}